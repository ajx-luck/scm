#ifndef  _WHQ_PFG_H_
#define  _WHQ_PFG_H_
/*******************************************************
注：Set_Pwm_Onoff()子函数中一直在检测AD，如果需要用其它AD，则暂时给0xff关闭AD检测，PFG会维持在当前状态
调用此库函数时需要占用EEPROM的0x12-0x15地址
********************************************************/
#pragma warning disable 752,759,520
/*******************************************************
调试变量声明
********************************************************/
extern volatile unsigned char cur_addat;				//CUR值
extern unsigned int pwmdisp;				//PWM值
extern unsigned int xldisp;					//将CURLIMITL设成200可以看斜率值
/*******************************************************
函数声明
********************************************************/
extern unsigned char Test_Pwm(void);											//此函数放在main主函数，建议扫描时间2.5~5ms
/*
返回数据：
0x00：
0x55：说明扫描错误
0xff：说明干烧缺水
0xaa：说明初始扫频成功
*/
extern void Set_Pwm_Onoff(unsigned char fun);								//此函数放在中断，建议中断时间125us
/*
入口参数：fun
0：为关闭PFG输出
1-PWMMAXC：设置输出占空比

0xff：为关闭AD检测，但是PFG还是正常输出
*/

/*************************************************************************/
/*************************************************************************/
/**************************************************************************
以下参数根据实际情况更改
**************************************************************************/
/*******************************************************
中心频率选择
PFG_SELECT = 1		:1.7M
PFG_SELECT = 2		:2.4M
PFG_SELECT = 3		:3.0M
PFG_SELECT = 4		:3.5M
********************************************************/
#define  PFG_SELECT		2//需根据实际雾化片频率修改

/*******************************************************
AD通道定义
********************************************************/
/*******************************************************/
#define  CUR_CH			1//定义CUR反馈AD通道，需根据实际电路调整

/*******************************************************
初始电流值预估
不开抖频
//1.7m建议值32
//2.4m建议值28
//3.0m建议值28

开启抖频
//1.7m建议值28
//2.4m建议值26
//3.0m建议值26
********************************************************/
#define	CURSET			26
/*******************************************************
扫频范围限定
限定规则：
例如2.4M雾化片：PWMFST=200则初始扫频频率约为(2.4+PWMFST*1.5/1000)M=2.70M
				PWMLST=200则初始扫频频率约为(2.4-PWMLST*1.5/1000)M=2.10M
********************************************************/
#define  PWMFST			250//此数范围0-255，默认即可
#define  PWMLST			250//此数范围0-255，默认即可

/*******************************************************
周期设置，范围0-255
********************************************************/
/*******************************************************/
#define  PWMMAXC		48//周期设置，时间为PWMMAXC*中断时间，一般默认即可

/*******************************************************
追频时占空比输出
********************************************************/
/*******************************************************/
#define  PWMCYL			24//24/48=1/2，一般默认即可

/*************************************************************************/
/*************************************************************************/
/**************************************************************************
以下参数为干烧检水设置参数
**************************************************************************/
/*************************************************************************/
/*************************************************************************/
/*******************************************************
雾化片干烧选项,总使能
0：不检测
1：检测
备注：
********************************************************/
#define  CURLIMITF		1


/*******************************************************
雾化片干烧斜率阈值
备注：需根据实际情况调整，雾化片厂家不同，此值会有些区别
********************************************************/
#define  CURLIMITL		10//越大越灵敏
//16mm-24V-1.7m建议值	8
//20mm-24V-1.7m建议值	10

//16mm-12V-2.4m建议值	6
//16mm-24V-2.4m建议值	10

//16mm-24V-3.0m建议值	10
//16mm-12V-3.0m建议值	8
/*******************************************************
干烧检水电流峰值判断阈值
********************************************************/
#define  CURLMTL		5//下限阈值
#define  CURLMTH		6//上限阈值

/*******************************************************
是否每次开机都扫频
1:每次开机都扫频
0：不断电情况下，只有第一次开机才扫频
********************************************************/
#define  KJ_FRE			1							//此数范围0-255
/*************************************************************************/
/*************************************************************************/
/**************************************************************************
以下为抖频参数设置
**************************************************************************/
/*************************************************************************/
/*************************************************************************/
/*******************************************************
抖频总使能
0：不使能
1：使能

注：1、选择时需注意电感是否会产生鸣叫，如果是则降低间隔
	2、测量MOS管D端尖峰电压是否超过MOS管耐压值
********************************************************/
#define  DMODEON	0

/*******************************************************
抖频范围
********************************************************/
#define  DRANGE		16//1~32

/*******************************************************
抖频步进
********************************************************/
#define  DBUJIN		bujin_2//bujin_1、bujin_2、bujin_4、bujin_8

/*******************************************************
抖频间隔
********************************************************/
#define  DJIANGE	jiange_4//jiange_1、jiange_2、jiange_4、jiange_8、jiange_16

/*************************************************************************/
/*************************************************************************/
/**************************************************************************/
/*以下内容勿修改*/
/**************************************************************************/
/**************************************************************************/
/**************************************************************************/
#define	jiange_1 0B00000000
#define	jiange_2 0B00000001
#define	jiange_4 0B00000010
#define	jiange_8 0B00000011
#define	jiange_16 0B00000100

#define	bujin_1 0B00000000
#define	bujin_2 0B00001000
#define	bujin_4 0B00010000
#define	bujin_8 0B00011000

const unsigned char pfg_select = PFG_SELECT;

const unsigned char Cur_Adcon = CUR_CH<<2;

const unsigned char PwmFst = PWMFST;
const unsigned char PwmLst = PWMLST;

const unsigned char Curlimitf = CURLIMITF;
const unsigned char Curlimitl = CURLIMITL;

const unsigned char Pwmmaxc = PWMMAXC;
const unsigned char Pwmcyl = PWMCYL;

const unsigned char Curlmtl = CURLMTL;
const unsigned char Curlmth = CURLMTH;
const unsigned char Kj_Fre = KJ_FRE;
const unsigned char curset = CURSET;

const unsigned char D_En = DMODEON;
const unsigned char Drange = DRANGE;
const unsigned char Dbujin = DBUJIN;
const unsigned char Djiange = DJIANGE;
/*******************************************************
					位定义
********************************************************/
#define	Set(x,y)	((x) |= (1 << (y)))				//位置1
#define	Clr(x,y)	((x) &= ~ (1 << (y)))			//位清0

#define	b0(x,y)		(((x) & (1 << (y))) == 0)		//位0判断 if(b0(x,y)) 判断是否为0
#define	b1(x,y)		((x) & (1 << (y)))				//位1判断 if(b1(x,y)) 判断是否为1
/*******************************************************
					宏定义
********************************************************/
#define uchar	unsigned char
#define uint	unsigned int
#define ulong	unsigned long 
/*******************************************************/
#endif



