---- H:\MyDownloads\说明书&测试报告\开发包\SC8F083开发包\SC8F083_DEMO_C\SC8F083_Timer_C_TEST\SC8P083_Timer2_C.c ----------------------------------------------------------------------
1:                /*-------------------------------------------
2:                
3:                程序名称：Timer2定时中断程序
4:                日期版本：2023/06/14 <V1.0>
5:                
6:                备注：   
7:                
8:                *本程序由 &应用支持部& 编写整理
9:                -------------------------------------------*/
10:               
11:               
12:               #include <sc.h>				//芯片头文件，会根据工程选项自动寻找对应型号头文件
13:               
14:               void Init_System();
15:               
16:               void main()
17:               {
18:               	Init_System();
  0037    118A    CLRB	0xA,3
  0038    2010    CALL	0x10
  0039    118A    CLRB	0xA,3
19:               	while(1)			
  003A    0064    CLRWDT
  003B    283A    JP	0x3A
20:               	{
21:               		asm("clrwdt");
22:               	}
23:               }
24:               
25:               
26:               /***********************************************
27:               函数名称：Timer_Isr
28:               函数功能：中断服务
29:               入口参数：无
30:               出口参数：无
31:               备注：
32:               ************************************************/
33:               void interrupt Timer_Isr()
34:               {
35:               	if(TMR2IF)
  0029    1283    CLRB	0x3,5
  002A    1303    CLRB	0x3,6
  002B    1C8D    SNZB	0xD,1
  002C    2830    JP	0x30
36:               	{
37:               		TMR2IF = 0;	//清中断标志位
  002D    108D    CLRB	0xD,1
38:               		PORTB ^= 0X08;
  002E    3008    LDIA	0x8
  002F    0686    XORR	0x6
  0030    0871    LD	A,0x71
  0031    008A    LD	0xA,A
  0032    0E70    SWAPA	0x70
  0033    0083    LD	0x3,A
  0034    0EFE    SWAPR	0x7E
  0035    0E7E    SWAPA	0x7E
  0036    0009    RETI
39:               	}
40:               }
41:               
42:               /***********************************************
43:               函数名称：Init_System
44:               函数功能：系统初始化
45:               入口参数：无
46:               出口参数：无
47:               备注：
48:               ************************************************/
49:               void Init_System()
50:               {
51:               	asm("nop");
52:               	asm("clrwdt");
53:               	INTCON = 0;					//系统初始化
  0012    018B    CLR	0xB
54:               	OSCCON = 0x72;				//16MHZ,内部振荡器用作系统时钟,CONFIG关闭WDT时必需软件打开WDT
  0013    3072    LDIA	0x72
  0014    1283    CLRB	0x3,5
  0015    1303    CLRB	0x3,6
  0016    0094    LD	0x14,A
55:               	OPTION_REG = 0x00;			//配置TIMER0时间，00为2分频
  0017    0181    CLR	0x1
  0018    0064    CLRWDT
56:               	asm("clrwdt");
57:               	
58:                   WPUB = 0B00111000;			//初始化上拉
  0019    3038    LDIA	0x38
  001A    1283    CLRB	0x3,5
  001B    1303    CLRB	0x3,6
  001C    0088    LD	0x8,A
59:                	WPDB = 0B00000000;			//初始化下拉
  001D    0187    CLR	0x7
60:               	TRISB = 0B00111000;			//初始化IO状态
  001E    0085    LD	0x5,A
61:               	PORTB = 0B00000000;			//初始化输出
  001F    0186    CLR	0x6
62:               	
63:               	
64:               	/**********  T2CON  *****************************************
65:               		Bit7      CLK_SEL:  时钟源选择
66:               			1=  选择外部 FLSE /4 作为 TMR2 时钟源（休眠态可继续计数）
67:               			0=  选择内部 FSYS /4 作为 TMR2 时钟源
68:               		Bit6~Bit3 TOUTPS<3:0>: TIMER2输出后分频比选择位。 
69:               			0000= 1:1后分频比； 
70:               			0001= 1:2后分频比； 
71:               			0010= 1:3后分频比； 
72:               			0011= 1:4后分频比； 
73:               			0100= 1:5后分频比； 
74:               			0101= 1:6后分频比； 
75:               			0110= 1:7后分频比； 
76:               			0111= 1:8后分频比； 
77:               			1000= 1:9后分频比； 
78:               			1001= 1:10后分频比； 
79:               			1010= 1:11后分频比； 
80:               			1011= 1:12后分频比； 
81:               			1100= 1:13后分频比； 
82:               			1101= 1:14后分频比； 
83:               			1110= 1:15后分频比； 
84:               			1111= 1:16后分频比。 
85:               		Bit2 TMR2ON: TIMER2使能位； 
86:               			1= 使能TIMER2； 
87:               			0= 禁止TIMER2。
88:               		Bit1~Bit0 T2CKPS<1:0>: TIMER2时钟预分频比选择位； 
89:               			00= 预分频值为1； 
90:               			01= 预分频值为4； 
91:               			1x= 预分频值为16。  
92:               	****************************************************************/
93:               	PR2 = 249;					//设定Timer初始值，定时周期是250*4/16M=62.5uS
  0020    30F9    LDIA	0xF9
  0021    0091    LD	0x11,A
94:               	TMR2IF = 0;
  0022    108D    CLRB	0xD,1
95:               	TMR2IE = 1;					//使能Timer2溢出中断
  0023    148E    SETB	0xE,1
96:               
97:               	T2CON = 0B00000101;			//开启Timer2，预分频为1：4，后分频为1：1，则定时时间为（249+1）*4*（4/16M）=250us
  0024    3005    LDIA	0x5
  0025    0093    LD	0x13,A
98:               								//timer2的时钟源为OSCCON配置的系统时钟/4
99:               	INTCON = 0XC0;				//开启总中断及外设中断
  0026    30C0    LDIA	0xC0
  0027    008B    LD	0xB,A
  0028    0008    RET
100:              
101:              }
---- stringtab ------------------------------------------------------------------
---- reset_enter ------------------------------------------------------------------
  0000    118A    CLRB	0xA,3
  0001    280B    JP	0xB
  000B    118A    CLRB	0xA,3
  000C    280D    JP	0xD
---- start_initialization ------------------------------------------------------------------
---- interrupt_function_enter ----------------------------------------------------------
  0004    00FE    LD	0x7E,A
  0005    0E03    SWAPA	0x3
  0006    00F0    LD	0x70,A
  0007    080A    LD	A,0xA
  0008    00F1    LD	0x71,A
  0009    118A    CLRB	0xA,3
  000A    2829    JP	0x29
---- common_function ------------------------------------------------------------------
  000D    0183    CLR	0x3
  000E    118A    CLRB	0xA,3
  000F    2837    JP	0x37
  0010    0000    NOP
  0011    0064    CLRWDT
