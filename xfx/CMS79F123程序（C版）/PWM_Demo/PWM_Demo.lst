---- E:\ZW PROJECT\DEMO程序\模板\79F系列_Demo(C语言)\CMS79F123程序（C版）\PWM\PWM.c ----------------------------------------------------------------------
1:                /*-------------------------------------------
2:                功能：PWM演示
3:                版本：V1.0
4:                日期：2020.06.20 
5:                
6:                *本程序由 中微半导体 &应用支持部& 编写整理
7:                *公司网址 www.mcu.com.cn
8:                *技术支持QQ 3001082102  罗工
9:                            3001030138	莫工
10:               -------------------------------------------*/
11:               
12:               #include <cms.h>
13:               
14:               void Set_PWM();
15:               
16:               void main()
  07D0    0000    NOP
  07D1    0064    CLRWDT
17:               {
18:               	asm("nop");
19:               	asm("clrwdt");
20:               	
21:               	OSCCON = 0X71;				//内部振荡器用作系统时钟
  07D2    3071    LDIA	0x71
  07D3    1683    SETB	0x3,5
  07D4    1303    CLRB	0x3,6
  07D5    008F    LD	0xF,A
22:               	
23:               	TRISA = 0;					//配置PWM引脚为输出脚
  07D6    0185    CLR	0x5
24:               	
25:               	Set_PWM();				//设置PWM周期50us，占空比PWM0-20%、PWM1-40%、PWM2-60%、PWM3-80%、PWM4-50%
  07D7    118A    CLRB	0xA,3
  07D8    27DC    CALL	0x7DC
  07D9    118A    CLRB	0xA,3
26:               	
27:               	while(1)
  07DA    0064    CLRWDT
  07DB    2FDA    JP	0x7DA
28:               	{
29:               		asm("clrwdt");
30:               	}
31:               }
32:               
33:               
34:               /***********************************************
35:               函数名称：Set_PWM
36:               函数功能：PWM输出模式配置
37:               入口参数：无
38:               出口参数：无
39:               备注：	//PWM周期 = [PWMTH<1:0>:PWMTL + 1]*Tosc*(CLKDIV分频)
40:               		//死区宽度 = (PWMxDT[5:0]+1)*TOSC*(CLKDIV分频值)
41:               		//占空比 = (PWMDx[9:0]+1)/(PWMT[9:0]+1)
42:               		//PWM组别选择: 工程选型-PWM_SEL
43:               ************************************************/
44:               void Set_PWM()
45:               {
46:               	PWMTL = 0x8f;					//PWM0~3共周期，周期低位
  07DC    308F    LDIA	0x8F
  07DD    1703    SETB	0x3,6
  07DE    008F    LD	0xF,A
47:               	PWMT4L = 0x8f;					//PWM4独立周期，周期低位		
  07DF    0091    LD	0x11,A
48:               	PWMTH = 0B00001101;				//周期高两位及PWM4占空比高两位	
  07E0    300D    LDIA	0xD
  07E1    0090    LD	0x10,A
49:               
50:               									//PWM0~3周期为：(0B110001111+1)*(1/16)*2 =50uS
51:               									//PWM4周期为：(0B1110001111+1)*(1/16)*2 =114uS		
52:               	
53:               
54:               	PWMD01H = 0x00;					//高位改变后不能立即生效，需要给占空比的低位寄存器后才能加载
  07E2    1283    CLRB	0x3,5
  07E3    019C    CLR	0x1C
55:               	//PWM1 占空比设置为20%
56:               	PWMD0L = 0x4f;					//(79+1)/(399+1) = 20%
  07E4    304F    LDIA	0x4F
  07E5    1683    SETB	0x3,5
  07E6    0093    LD	0x13,A
57:               	//PWM1 占空比设置为40%
58:               	PWMD1L = 0x9f;					//(159+1)/(399+1) = 40%
  07E7    309F    LDIA	0x9F
  07E8    0094    LD	0x14,A
59:               
60:               	PWMD23H = 0x10;
  07E9    3010    LDIA	0x10
  07EA    1283    CLRB	0x3,5
  07EB    009D    LD	0x1D,A
61:               	//PWM2 占空比设置为60%
62:               	PWMD2L = 0xef;					//(239+1)/(399+1) = 60%
  07EC    30EF    LDIA	0xEF
  07ED    1683    SETB	0x3,5
  07EE    0095    LD	0x15,A
63:               	//PWM3 占空比设置为80%
64:               	PWMD3L = 0x3f;					//(319+1)/(399+1) = 80%
  07EF    303F    LDIA	0x3F
  07F0    0096    LD	0x16,A
65:               
66:               	//PWM4 占空比设置为50%
67:               	PWMD4L = 0xE3;					//(227+1)/(911+1) = 25%
  07F1    30E3    LDIA	0xE3
  07F2    0097    LD	0x17,A
68:               	
69:               	
70:               	PWM01DT = 0x3F;					//死区时间，低6位有效位=(0B00111111+1)*(1/16)*1 =4uS
  07F3    303F    LDIA	0x3F
  07F4    1303    CLRB	0x3,6
  07F5    0093    LD	0x13,A
71:               	PWM23DT = 0;
  07F6    0194    CLR	0x14
72:               	
73:               	PWMCON2 = 0B00000000;			//正常输出
  07F7    1283    CLRB	0x3,5
  07F8    1703    SETB	0x3,6
  07F9    0189    CLR	0x9
74:               	PWMCON1 = 0B00000000;			//禁止死区；可使能PWM0/1互补，PWM2/3互补
  07FA    0188    CLR	0x8
75:               	PWMCON0 = 0B00111111;			//PWM分频Fosc/2，使能PWM0、PWM1、PWM2、PWM3、PWM4
  07FB    0087    LD	0x7,A
  07FC    0008    RET
76:               
77:               }
---- stringtab ------------------------------------------------------------------
---- reset_enter ------------------------------------------------------------------
  0000    118A    CLRB	0xA,3
  0001    2FFD    JP	0x7FD
---- start_initialization ------------------------------------------------------------------
---- interrupt_function_enter ----------------------------------------------------------
---- common_function ------------------------------------------------------------------
  07FD    0183    CLR	0x3
  07FE    118A    CLRB	0xA,3
  07FF    2FD0    JP	0x7D0
